\documentclass{article}

\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}

\usepackage{natbib}
\usepackage{hyperref}
\bibliographystyle{chicago}

\usepackage{graphicx}

\title{Thesis}
\date{\today}
\author{Sang Woo Park}

\begin{document}
\maketitle


\section{Introduction}

Fitting models. Too many methods and too many models. What should we do?

\section{SIR model}

The susceptible-infected-recovered (SIR) model is one of the simplest epidemic models which describe how disease spreads in a homogeneously mixing population.
In general, the SIR model can be written as 
\begin{equation}
\begin{aligned}
\frac{dS}{dt} &= b(t) - (\phi(t) + \mu) S\\
\frac{dI}{dt} &= \phi(t) S - (\gamma + \mu) I\\
\frac{dR}{dt} &= \gamma I - \mu R
\end{aligned}
\label{eq:sir}
\end{equation}
where $S$, $I$, and $R$ describe the number of susceptible, infected, and recovered individuals.
$b(t)$ represents recruitment rate to the susceptible population, $\mu$ represents natural mortality rate, and $\gamma$ represents per-capita recovery rate.
$\phi(t)$ represents force of infection, which is defined as the rate at which a susceptible individual acquires infection.
We write $\phi(t) = \beta(t) I/N$ to represent \textit{frequency}-dependent action or $\phi(t) = \beta I$ to represent \textit{density}-dependent action, where $N = S + I + R$ is the total population size.
%% heterogeneity and what not
For this study, we focus on $\phi(t) = \beta(t)I/N$.

Typically, data suffers from under-reporting and we may want to understand the dynamics of $\rho I$ instead, where $\rho$ is the reporting rate.
Then, we can write
\begin{equation}
\begin{aligned}
\frac{dS}{dt} &= b(t) - \beta S \frac{\hat{I}}{\rho N} \\
\frac{d\hat{I}}{dt} &= \beta S \frac{\hat{I}}{N} - \gamma \hat{I} \\
\end{aligned}
\label{eq:rhosir}
\end{equation}

\subsection{Incidence, prevalence, and mortality}

\begin{figure}[t]
\includegraphics[width=\textwidth]{../figure/inc_prev_mort.pdf}
\end{figure}

We want to distinguish among different kinds of data: prevalence, incidence, and mortality.
Prevalence is defined as the total number of infected individuals present in the population and corresponds to $\hat{I}(t)$.
Incidence is defined as the number of newly infected cases. 
Hence, incidence report at time $t$ corresponds to the integral of the total infection rate from the previous reporting period $t - \Delta t$ and current reporting period $t$:
\begin{equation}
\int_{t-\Delta t}^{t} \beta(s) S \frac{\hat{I}}{N} ds.
\end{equation}
Finally, mortality is defined as the number of individuals that died over a time period.
Like incidence, mortality can be written as the integral of the total death rate:
\begin{equation}
\int_{t-\Delta t}^{t} \gamma \hat{I} ds.
\end{equation}

The main difference among the three types is that prevalence counts provide a direct observation of a state variable whereas incidence and mortality counts do not.
As a result, 

In this article, we focus on fitting to incidence data only.
In particular, we consider two kinds of models: continuous deterministic models and discrete stochastic models.
We do not consider fitting continuous stochastic models because they are computationally too expensive.

\section{Fitting continuous deterministic models}

\subsection{Trajectory matching}

Trajectory matching is one of the simplest fitting methods.
As its name suggests, the goal is to find a set of parameters such that the simulated trajectory, from the ODE model, best matches the observed data.
This method assumes that there is only measurement error and no process error.
The measurement model can be written as:
\begin{equation}
y_t \sim \mathrm{NegBinomial}\left(\mu_t= \int_{t-\Delta t}^{t} \beta(s) S \frac{\hat{I}}{N} ds, \phi \right),
\end{equation}
where $\rho$ is reporting rate and $\phi$ is dispersion parameter.
We prefer this model compared to the binomial or beta-binomial model because fitting binomial or beta-binomial models may not work if there are any irregular patterns in the data.

\subsection{Gradient matching}

\begin{figure}[t]
\includegraphics[width=\textwidth]{../figure/gradient_matching_sinusoidal.pdf}
\end{figure}

When \emph{all} state variables are observed, we can fit smooth curves to the data and obtain an estimate of the gradients of the ODE by taking the derivatives of the estimated smooth functions.
Gradient matching methods seek to estimate the rate equation using nonparametric regression.
However, for most epidemics, it is impossible to have data of all state variables.
When only incidence is provided, we have no direct observations of any state variables. 
If we can reconstruct the dynamics of the susceptible population and assume that incidence is sufficiently similar to prevalence, we can still be able to apply gradient mathing methods.

Observe that
\begin{equation}
\frac{d \log\hat{I}}{dt} = \beta(t) \frac{S}{N} - (\gamma + \mu),
\end{equation}
If we can obtain a reasonable estimate of the gradient $Z_i = d \log \hat{I}/dt (t_i)$, we can write
\begin{equation}
Z_i + (\gamma + \mu) = \exp \left(\log \beta (t_i) + \log S_i - \log N \right)  + \epsilon_i
\end{equation}
and estimate $\beta$, given that we can reconstruct the susceptible dynamics $S_i$.
Estimate of $\beta$ can be done using nonparametric regression by treating $\log S_i$ and $\log N$ as offset terms.

First, we want to test whether gradients can be reliably estimated from incidence data alone by simulating a deterministic SIR model with measurement error.
We use natural cubic spline with knots placed every 6 biweeks.
It works generally well but there is systematic bias.
When gradients are at their local maxima (and minima), we tend to overestimate (and underestimate) the gradients.
This is because incidence precedes prevalence???

If we simply construct confidence intervals based on equation ?? we underestimate uncertainty significantly by ignoring the uncertainty in the estimated gradients $Z_i$.



Conditions:
\begin{itemize}
	\item See Jost and Ellner (???)
	\item sampled sufficiently
	\item not too much error
	\item Brunel Parameter estimation of ODEâ€™s via nonparametric estimators
\end{itemize}


%% read pomp-Astic somewhere

\subsection{Generalized profiling}

Generalized profiling combines trajectory matching with gradient matching.

\subsection{Spectral matching}

What is this? Read Reuman et al. 2006
%% https://www.pnas.org/content/pnas/103/49/18860.full.pdf


\section{Discrete-time SIR model}

\subsection{Time-series SIR model}

TSIR:
\begin{equation}
\begin{aligned}
S_{t + \Delta t} &= B_t + S_t - \beta_t S_t \frac{I_t}{N_t} \Delta t\\
I_{t + \Delta t} &= \beta_t S_t \frac{I_t}{N_t} \Delta t
\end{aligned}
\end{equation}
Assumptions are:
\begin{itemize}
	\item Fixed generation time
	\item Linear probability of infection
\end{itemize}

\subsection{Hazard-based model}

Hazard-based model:
\begin{equation}
\begin{aligned}
S_{t + \Delta t} &= B_t + S_t - S_t \left(1- \exp\left(-\beta_t \frac{I_t}{N_t} \Delta t\right)\right)\\
I_{t + \Delta t} &= S_t \left( 1- \exp\left(-\beta_t \frac{I_t}{N_t} \Delta t\right)\right) + I_t - I_t (1 - \exp(-(\gamma + \mu) \Delta t))
\end{aligned}
\end{equation}
Tries to account for variation in ... but still ... When are these assumptions appropriate?

\subsection{Generation-based model}





\subsection{Probability of infection}

In both the TSIR model and the hazard-based model, transition from the susceptible comparment, $S$, to the infected compartment, $I$, is represented as a product of number of susceptible individuals and probability of infection between two time steps $t$ and $t + \Delta t$.
The TSIR model assumes that the probability of infection is a linear function of prevalence $I_t$.
This formulation is based on the Euler approximation to the solution of the ordinary differential equation.
On the other hand, the hazard-based model assumes that the probability of infection is an inverse exponential function of prevalence $I_t$.
Besides their differences in the relationship between prevalence and probability of infection, there are two more assumptions that we need to consider: (1) force of infection remains constant over two time steps and (2) new susceptible individuals have zero probability of infection between the two time steps.



\subsection{Infectious period}

Geometric distribution with probability of $1-\exp(-\gamma \Delta t)$ and unit of $\Delta t$.
Then, mean infectious period and generation interval is given by 
\begin{equation}
\frac{\Delta t}{1-\exp(-\gamma \Delta t)}.
\end{equation}
An important but often overlooked component is the variance of the distribution.
Squared coefficient of variation for this distribution is equal to $\exp(-\gamma \Delta t)$, which necessarily depends on pre-specified time-step $\Delta t$.
If we want to match the mean of the distribution to a fixed value $\mu$ regardless of our choices of $\Delta t$, we obtain 
\begin{equation}
\hat \gamma = - \frac{1}{\Delta t} \log\left(1 - \frac{\Delta t}{\mu}\right)
\end{equation}
Then,
\begin{equation}
\mathrm{CV}_{\tiny\textrm{Infectious period}}(\Delta t)^2 = 1 - \frac{\Delta t}{\mu}.
\end{equation}

We expect changes in variation in infectious period to affect variation in stochstic realizations.

This means that the relationship between $r$ and $\mathcal R$ changes.
For this generation-interval distribution, we have
\begin{equation}
\mathcal R = 1 + \frac{\exp(r) -1}{(1-\exp(-\gamma \Delta t)) }
\end{equation}
Substituting 
\begin{equation}
r = \frac{1}{\Delta t} \log \left(1 + \beta \Delta t - \frac{\Delta t}{\mu}\right),
\end{equation}
as well as $\hat \gamma$, we get
\begin{equation}
\mathcal R = 1 + \frac{\mu}{\Delta t} \left(1 + \beta \Delta t - \frac{\Delta t}{\mu}\right)^{1/\Delta t}
\end{equation}
Then, we can obtain a relationship between $\mathcal R$ of a discrete-time system and that of a corresponding continuous time system, assuming that contact rate $\beta$ and mean generation-time $\mu$ are the same:
\begin{equation}
\mathcal R_{\tiny \textrm{discrete}} = 1 + \frac{\mu}{\Delta t} \left(1 + \frac{(\mathcal R_{\tiny \textrm{continuous}}  - 1) \Delta t }{\mu}\right)^{1/\Delta t}
\end{equation}

On the other hand, we may want to match choose $\beta$ and $\mu$ to match true $r$ and $\mathcal R$.



% We find that the formula for reproduction number suggested by \cite{he2009plug} only holds when generation interval is held constant.

First, we compare how the dynamics of a system depend on the value of $\Delta t$?



\section{Model fitting}

\begin{itemize}
	\item Trajectory matching
	\item Gradient matching
	\item Generalized profiling
	\item TSIR
	\item Particle filter
	\item Synthetic likelihood
\end{itemize}

\section{Bibliography}

\bibliography{thesis}

\section{Appendix}

\subsection{Derivation of growth rate in discrete-time SIR model}


Derivation:
\begin{equation}
\begin{aligned}
S_{t+\Delta t} &= S_t - S_t (1- \exp(-\beta I_t \Delta t/N))\\
I_{t+\Delta t} &= S_t (1- \exp(-\beta I_t \Delta t/N)) + I_t - I_t (1- \exp(-\gamma \Delta t))
\end{aligned}
\end{equation}
Assuming tat $S_t$ is approximately equal to $N$, we get
\begin{equation}
I_{t+\Delta t} = N_t (1- \exp(-\beta I_t \Delta t/N)) + I_t \exp(-\gamma \Delta t)
\end{equation}
When $I_t \approx 0$, $\exp(-\beta I_t \Delta t/N) \approx 1 - \beta I_t \Delta t/N$ and so
\begin{equation}
\begin{aligned}
I_{t+\Delta t} &\approx  I_t \beta \Delta t + I_t \exp(-\gamma \Delta t)\\
&= I_t (\beta \Delta t + \exp(-\gamma \Delta t))
\end{aligned}
\end{equation}
Substituting $\hat{\gamma}$, we get
\begin{equation}
I_{t+\Delta t} = I_t \left(1 + \beta \Delta t - \frac{\Delta t}{\mu}\right),
\end{equation}
Therefore,
\begin{equation}
I_{t} = I_0 \left(1 + \beta\Delta t - \frac{\Delta t}{\mu}\right)^{t/\Delta t}
\end{equation}
and the initial growth rate is given by
\begin{equation}
r = \frac{1}{\Delta t} \log \left(1 + \beta \Delta t - \frac{\Delta t}{\mu}\right).
\end{equation}



\end{document}
